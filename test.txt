import json
import requests
import sqlite3 as sl
import streamlit as st
import pandas as pd

def session():
    con = sl.connect('data.db')
    with con:
        sql_data = con.execute("select count(*) from sqlite_master where type='table' and name='points'")
        for i in sql_data:
            if i[0] == 0:
                con.execute("""
                    CREATE TABLE points (
                    day REAL,
                    distance REAL,
                    SH REAL
                    );
                    """)

    return con

def stop_session():
    con = session()
    with con:
        con.execute("DELETE FROM points")
    con.close()

def data_update():
    con = session()
    points_sql = 'INSERT INTO points (date, time, distance, SH) values(?, ?, ?)'
    distance = [0] * 6
    SH = [0] * 6
    response = requests.get("https://dt.miet.ru/ppo_it_final",
                            headers={"X-Auth-Token": "xutgb523"})
    data = json.loads(response.text)
    k = 0
    for i in data['message']:
        k1 = 0
        for j in i['points']:
            distance[k] = j['distance']
            SH[k] = j['SH']
            k1, k = k1 + 1, k + 1

    print(distance)
    print(SH)



data_update()